import pytest

import pig


MULTIPLE_IMPORTS = """digraph unittest {
\tunittest [label=unittest]
\tunittest -> os [style=solid]
\tunittest -> sys [style=solid]
\tunittest -> tempfile [style=solid]
\tunittest -> StringIO [style=dotted]
\tunittest -> UserDict [style=dotted]
\tunittest -> __builtin__ [style=dotted]
\tunittest -> __future__ [style=dotted]
\tunittest -> __main__ [style=dotted]
\tunittest -> _abcoll [style=dotted]
\tunittest -> _codecs [style=dotted]
\tunittest -> _collections [style=dotted]
\tunittest -> _emx_link [style=dotted]
\tunittest -> _functools [style=dotted]
\tunittest -> _hashlib [style=dotted]
\tunittest -> _heapq [style=dotted]
\tunittest -> _io [style=dotted]
\tunittest -> _locale [style=dotted]
\tunittest -> _md5 [style=dotted]
\tunittest -> _pytest [style=dotted]
\tunittest -> "_pytest.assertion" [style=dotted]
\tunittest -> "_pytest.compat" [style=dotted]
\tunittest -> "_pytest.config" [style=dotted]
\tunittest -> "_pytest.debugging" [style=dotted]
\tunittest -> "_pytest.fixtures" [style=dotted]
\tunittest -> "_pytest.freeze_support" [style=dotted]
\tunittest -> "_pytest.main" [style=dotted]
\tunittest -> "_pytest.mark" [style=dotted]
\tunittest -> "_pytest.nodes" [style=dotted]
\tunittest -> "_pytest.outcomes" [style=dotted]
\tunittest -> "_pytest.python" [style=dotted]
\tunittest -> "_pytest.python_api" [style=dotted]
\tunittest -> "_pytest.recwarn" [style=dotted]
\tunittest -> "_pytest.warning_types" [style=dotted]
\tunittest -> _random [style=dotted]
\tunittest -> _sha [style=dotted]
\tunittest -> _sha256 [style=dotted]
\tunittest -> _sha512 [style=dotted]
\tunittest -> _sre [style=dotted]
\tunittest -> _struct [style=dotted]
\tunittest -> _subprocess [style=dotted]
\tunittest -> _threading_local [style=dotted]
\tunittest -> _version [style=dotted]
\tunittest -> _warnings [style=dotted]
\tunittest -> _weakref [style=dotted]
\tunittest -> _weakrefset [style=dotted]
\tunittest -> abc [style=dotted]
\tunittest -> array [style=dotted]
\tunittest -> atexit [style=dotted]
\tunittest -> bdb [style=dotted]
\tunittest -> binascii [style=dotted]
\tunittest -> cPickle [style=dotted]
\tunittest -> cStringIO [style=dotted]
\tunittest -> ce [style=dotted]
\tunittest -> cmd [style=dotted]
\tunittest -> codecs [style=dotted]
\tunittest -> collections [style=dotted]
\tunittest -> copy [style=dotted]
\tunittest -> copy_reg [style=dotted]
\tunittest -> difflib [style=dotted]
\tunittest -> dis [style=dotted]
\tunittest -> doctest [style=dotted]
\tunittest -> dummy_thread [style=dotted]
\tunittest -> encodings [style=dotted]
\tunittest -> errno [style=dotted]
\tunittest -> exceptions [style=dotted]
\tunittest -> fcntl [style=dotted]
\tunittest -> fnmatch [style=dotted]
\tunittest -> functools [style=dotted]
\tunittest -> gc [style=dotted]
\tunittest -> genericpath [style=dotted]
\tunittest -> hashlib [style=dotted]
\tunittest -> heapq [style=dotted]
\tunittest -> imp [style=dotted]
\tunittest -> inspect [style=dotted]
\tunittest -> io [style=dotted]
\tunittest -> itertools [style=dotted]
\tunittest -> keyword [style=dotted]
\tunittest -> linecache [style=dotted]
\tunittest -> logging [style=dotted]
\tunittest -> marshal [style=dotted]
\tunittest -> math [style=dotted]
\tunittest -> msvcrt [style=dotted]
\tunittest -> nt [style=dotted]
\tunittest -> ntpath [style=dotted]
\tunittest -> opcode [style=dotted]
\tunittest -> operator [style=dotted]
\tunittest -> "org.python.core" [style=dotted]
\tunittest -> "os.path" [style=dotted]
\tunittest -> os2 [style=dotted]
\tunittest -> os2emxpath [style=dotted]
\tunittest -> pdb [style=dotted]
\tunittest -> pickle [style=dotted]
\tunittest -> posix [style=dotted]
\tunittest -> posixpath [style=dotted]
\tunittest -> pprint [style=dotted]
\tunittest -> pwd [style=dotted]
\tunittest -> pytest [style=dotted]
\tunittest -> random [style=dotted]
\tunittest -> re [style=dotted]
\tunittest -> readline [style=dotted]
\tunittest -> repr [style=dotted]
\tunittest -> riscos [style=dotted]
\tunittest -> riscosenviron [style=dotted]
\tunittest -> riscospath [style=dotted]
\tunittest -> select [style=dotted]
\tunittest -> shlex [style=dotted]
\tunittest -> signal [style=dotted]
\tunittest -> sre_compile [style=dotted]
\tunittest -> sre_constants [style=dotted]
\tunittest -> sre_parse [style=dotted]
\tunittest -> stat [style=dotted]
\tunittest -> string [style=dotted]
\tunittest -> strop [style=dotted]
\tunittest -> struct [style=dotted]
\tunittest -> subprocess [style=dotted]
\tunittest -> thread [style=dotted]
\tunittest -> threading [style=dotted]
\tunittest -> time [style=dotted]
\tunittest -> token [style=dotted]
\tunittest -> tokenize [style=dotted]
\tunittest -> traceback [style=dotted]
\tunittest -> types [style=dotted]
\tunittest -> unittest [style=dotted]
\tunittest -> warnings [style=dotted]
\tunittest -> weakref [style=dotted]
}"""

MULTIPLE_IMPORT_FROMS = """digraph unittest {
\tunittest [label=unittest]
\tunittest -> os [style=solid]
\tunittest -> sys [style=solid]
\tunittest -> tempfile [style=solid]
\tunittest -> StringIO [style=dotted]
\tunittest -> UserDict [style=dotted]
\tunittest -> __builtin__ [style=dotted]
\tunittest -> __future__ [style=dotted]
\tunittest -> __main__ [style=dotted]
\tunittest -> _abcoll [style=dotted]
\tunittest -> _codecs [style=dotted]
\tunittest -> _collections [style=dotted]
\tunittest -> _emx_link [style=dotted]
\tunittest -> _functools [style=dotted]
\tunittest -> _hashlib [style=dotted]
\tunittest -> _heapq [style=dotted]
\tunittest -> _io [style=dotted]
\tunittest -> _locale [style=dotted]
\tunittest -> _md5 [style=dotted]
\tunittest -> _pytest [style=dotted]
\tunittest -> "_pytest.assertion" [style=dotted]
\tunittest -> "_pytest.compat" [style=dotted]
\tunittest -> "_pytest.config" [style=dotted]
\tunittest -> "_pytest.debugging" [style=dotted]
\tunittest -> "_pytest.fixtures" [style=dotted]
\tunittest -> "_pytest.freeze_support" [style=dotted]
\tunittest -> "_pytest.main" [style=dotted]
\tunittest -> "_pytest.mark" [style=dotted]
\tunittest -> "_pytest.nodes" [style=dotted]
\tunittest -> "_pytest.outcomes" [style=dotted]
\tunittest -> "_pytest.python" [style=dotted]
\tunittest -> "_pytest.python_api" [style=dotted]
\tunittest -> "_pytest.recwarn" [style=dotted]
\tunittest -> "_pytest.warning_types" [style=dotted]
\tunittest -> _random [style=dotted]
\tunittest -> _sha [style=dotted]
\tunittest -> _sha256 [style=dotted]
\tunittest -> _sha512 [style=dotted]
\tunittest -> _sre [style=dotted]
\tunittest -> _struct [style=dotted]
\tunittest -> _subprocess [style=dotted]
\tunittest -> _threading_local [style=dotted]
\tunittest -> _version [style=dotted]
\tunittest -> _warnings [style=dotted]
\tunittest -> _weakref [style=dotted]
\tunittest -> _weakrefset [style=dotted]
\tunittest -> abc [style=dotted]
\tunittest -> array [style=dotted]
\tunittest -> atexit [style=dotted]
\tunittest -> bdb [style=dotted]
\tunittest -> binascii [style=dotted]
\tunittest -> cPickle [style=dotted]
\tunittest -> cStringIO [style=dotted]
\tunittest -> ce [style=dotted]
\tunittest -> cmd [style=dotted]
\tunittest -> codecs [style=dotted]
\tunittest -> collections [style=dotted]
\tunittest -> copy [style=dotted]
\tunittest -> copy_reg [style=dotted]
\tunittest -> difflib [style=dotted]
\tunittest -> dis [style=dotted]
\tunittest -> doctest [style=dotted]
\tunittest -> dummy_thread [style=dotted]
\tunittest -> encodings [style=dotted]
\tunittest -> errno [style=dotted]
\tunittest -> exceptions [style=dotted]
\tunittest -> fcntl [style=dotted]
\tunittest -> fnmatch [style=dotted]
\tunittest -> functools [style=dotted]
\tunittest -> gc [style=dotted]
\tunittest -> genericpath [style=dotted]
\tunittest -> hashlib [style=dotted]
\tunittest -> heapq [style=dotted]
\tunittest -> imp [style=dotted]
\tunittest -> inspect [style=dotted]
\tunittest -> io [style=dotted]
\tunittest -> itertools [style=dotted]
\tunittest -> keyword [style=dotted]
\tunittest -> linecache [style=dotted]
\tunittest -> logging [style=dotted]
\tunittest -> marshal [style=dotted]
\tunittest -> math [style=dotted]
\tunittest -> msvcrt [style=dotted]
\tunittest -> nt [style=dotted]
\tunittest -> ntpath [style=dotted]
\tunittest -> opcode [style=dotted]
\tunittest -> operator [style=dotted]
\tunittest -> "org.python.core" [style=dotted]
\tunittest -> "os.path" [style=dotted]
\tunittest -> os2 [style=dotted]
\tunittest -> os2emxpath [style=dotted]
\tunittest -> pdb [style=dotted]
\tunittest -> pickle [style=dotted]
\tunittest -> posix [style=dotted]
\tunittest -> posixpath [style=dotted]
\tunittest -> pprint [style=dotted]
\tunittest -> pwd [style=dotted]
\tunittest -> pytest [style=dotted]
\tunittest -> random [style=dotted]
\tunittest -> re [style=dotted]
\tunittest -> readline [style=dotted]
\tunittest -> repr [style=dotted]
\tunittest -> riscos [style=dotted]
\tunittest -> riscosenviron [style=dotted]
\tunittest -> riscospath [style=dotted]
\tunittest -> select [style=dotted]
\tunittest -> shlex [style=dotted]
\tunittest -> signal [style=dotted]
\tunittest -> sre_compile [style=dotted]
\tunittest -> sre_constants [style=dotted]
\tunittest -> sre_parse [style=dotted]
\tunittest -> stat [style=dotted]
\tunittest -> string [style=dotted]
\tunittest -> strop [style=dotted]
\tunittest -> struct [style=dotted]
\tunittest -> subprocess [style=dotted]
\tunittest -> thread [style=dotted]
\tunittest -> threading [style=dotted]
\tunittest -> time [style=dotted]
\tunittest -> token [style=dotted]
\tunittest -> tokenize [style=dotted]
\tunittest -> traceback [style=dotted]
\tunittest -> types [style=dotted]
\tunittest -> unittest [style=dotted]
\tunittest -> warnings [style=dotted]
\tunittest -> weakref [style=dotted]
}"""

MIXED_IMPORTS = """digraph unittest {
\tunittest [label=unittest]
\tunittest -> logging [style=solid]
\tunittest -> os [style=solid]
\tunittest -> sys [style=solid]
\tunittest -> tempfile [style=solid]
\tunittest -> StringIO [style=dotted]
\tunittest -> UserDict [style=dotted]
\tunittest -> __builtin__ [style=dotted]
\tunittest -> __future__ [style=dotted]
\tunittest -> __main__ [style=dotted]
\tunittest -> _abcoll [style=dotted]
\tunittest -> _codecs [style=dotted]
\tunittest -> _collections [style=dotted]
\tunittest -> _emx_link [style=dotted]
\tunittest -> _functools [style=dotted]
\tunittest -> _hashlib [style=dotted]
\tunittest -> _heapq [style=dotted]
\tunittest -> _io [style=dotted]
\tunittest -> _locale [style=dotted]
\tunittest -> _md5 [style=dotted]
\tunittest -> _pytest [style=dotted]
\tunittest -> "_pytest.assertion" [style=dotted]
\tunittest -> "_pytest.compat" [style=dotted]
\tunittest -> "_pytest.config" [style=dotted]
\tunittest -> "_pytest.debugging" [style=dotted]
\tunittest -> "_pytest.fixtures" [style=dotted]
\tunittest -> "_pytest.freeze_support" [style=dotted]
\tunittest -> "_pytest.main" [style=dotted]
\tunittest -> "_pytest.mark" [style=dotted]
\tunittest -> "_pytest.nodes" [style=dotted]
\tunittest -> "_pytest.outcomes" [style=dotted]
\tunittest -> "_pytest.python" [style=dotted]
\tunittest -> "_pytest.python_api" [style=dotted]
\tunittest -> "_pytest.recwarn" [style=dotted]
\tunittest -> "_pytest.warning_types" [style=dotted]
\tunittest -> _random [style=dotted]
\tunittest -> _sha [style=dotted]
\tunittest -> _sha256 [style=dotted]
\tunittest -> _sha512 [style=dotted]
\tunittest -> _sre [style=dotted]
\tunittest -> _struct [style=dotted]
\tunittest -> _subprocess [style=dotted]
\tunittest -> _threading_local [style=dotted]
\tunittest -> _version [style=dotted]
\tunittest -> _warnings [style=dotted]
\tunittest -> _weakref [style=dotted]
\tunittest -> _weakrefset [style=dotted]
\tunittest -> abc [style=dotted]
\tunittest -> array [style=dotted]
\tunittest -> atexit [style=dotted]
\tunittest -> bdb [style=dotted]
\tunittest -> binascii [style=dotted]
\tunittest -> cPickle [style=dotted]
\tunittest -> cStringIO [style=dotted]
\tunittest -> ce [style=dotted]
\tunittest -> cmd [style=dotted]
\tunittest -> codecs [style=dotted]
\tunittest -> collections [style=dotted]
\tunittest -> copy [style=dotted]
\tunittest -> copy_reg [style=dotted]
\tunittest -> difflib [style=dotted]
\tunittest -> dis [style=dotted]
\tunittest -> doctest [style=dotted]
\tunittest -> dummy_thread [style=dotted]
\tunittest -> encodings [style=dotted]
\tunittest -> errno [style=dotted]
\tunittest -> exceptions [style=dotted]
\tunittest -> fcntl [style=dotted]
\tunittest -> fnmatch [style=dotted]
\tunittest -> functools [style=dotted]
\tunittest -> gc [style=dotted]
\tunittest -> genericpath [style=dotted]
\tunittest -> hashlib [style=dotted]
\tunittest -> heapq [style=dotted]
\tunittest -> imp [style=dotted]
\tunittest -> inspect [style=dotted]
\tunittest -> io [style=dotted]
\tunittest -> itertools [style=dotted]
\tunittest -> keyword [style=dotted]
\tunittest -> linecache [style=dotted]
\tunittest -> marshal [style=dotted]
\tunittest -> math [style=dotted]
\tunittest -> msvcrt [style=dotted]
\tunittest -> nt [style=dotted]
\tunittest -> ntpath [style=dotted]
\tunittest -> opcode [style=dotted]
\tunittest -> operator [style=dotted]
\tunittest -> "org.python.core" [style=dotted]
\tunittest -> "os.path" [style=dotted]
\tunittest -> os2 [style=dotted]
\tunittest -> os2emxpath [style=dotted]
\tunittest -> pdb [style=dotted]
\tunittest -> pickle [style=dotted]
\tunittest -> posix [style=dotted]
\tunittest -> posixpath [style=dotted]
\tunittest -> pprint [style=dotted]
\tunittest -> pwd [style=dotted]
\tunittest -> pytest [style=dotted]
\tunittest -> random [style=dotted]
\tunittest -> re [style=dotted]
\tunittest -> readline [style=dotted]
\tunittest -> repr [style=dotted]
\tunittest -> riscos [style=dotted]
\tunittest -> riscosenviron [style=dotted]
\tunittest -> riscospath [style=dotted]
\tunittest -> select [style=dotted]
\tunittest -> shlex [style=dotted]
\tunittest -> signal [style=dotted]
\tunittest -> sre_compile [style=dotted]
\tunittest -> sre_constants [style=dotted]
\tunittest -> sre_parse [style=dotted]
\tunittest -> stat [style=dotted]
\tunittest -> string [style=dotted]
\tunittest -> strop [style=dotted]
\tunittest -> struct [style=dotted]
\tunittest -> subprocess [style=dotted]
\tunittest -> thread [style=dotted]
\tunittest -> threading [style=dotted]
\tunittest -> time [style=dotted]
\tunittest -> token [style=dotted]
\tunittest -> tokenize [style=dotted]
\tunittest -> traceback [style=dotted]
\tunittest -> types [style=dotted]
\tunittest -> unittest [style=dotted]
\tunittest -> warnings [style=dotted]
\tunittest -> weakref [style=dotted]
}"""


@pytest.mark.parametrize(
    "test_input,expected", [
        pytest.param(
            "", "digraph unittest {\n\tunittest [label=unittest]\n}", id="no imports"
        ),
        pytest.param(
            "import sys",
            "digraph unittest {\n\tunittest [label=unittest]\n\tunittest -> sys [style=solid]\n}",
            id="simple import"
        ),
        pytest.param(
            "from sys import argv",
            "digraph unittest {\n\tunittest [label=unittest]\n\tunittest -> sys [style=solid]\n}",
            id="simple import from"
        ),
        pytest.param(
            "import os; import sys; import tempfile",
            MULTIPLE_IMPORTS,
            id="multiple imports"
        ),
        pytest.param(
            "from os import path; from sys import version; from tempfile import mkstemp",
            MULTIPLE_IMPORT_FROMS,
            id="multiple import froms"
        ),
        pytest.param(
            "import logging; from os import path; import sys; from tempfile import mkstemp",
            MIXED_IMPORTS,
            id="mixed imports"
        ),
    ]
)
def test_import_graph_generation(test_input, expected):
    x = pig.generate_import_graph(test_input, "unittest")
    assert x.source == expected
